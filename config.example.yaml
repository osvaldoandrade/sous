cluster_name: cs-prod-1
environment: prod

plugins:
  authn:
    driver: tikti
    tikti:
      introspection_url: http://localhost:8099/introspect
      cache_ttl_seconds: 60
      api_key: ""
  persistence:
    driver: kvrocks
    kvrocks:
      addr: localhost:6666
      auth:
        mode: none
        password: ""
  messaging:
    driver: codeq
    codeq:
      base_url: http://localhost:8080
      producer_token: ""
      worker_token: ""
      # Legacy transport (Kafka-compatible) can still be enabled with brokers.
      brokers: []
      topics:
        invoke: cs.invoke
        results: cs.results
        dlq_invoke: cs.dlq.invoke
        dlq_results: cs.dlq.results

# Legacy compatibility fields (optional during migration window).
kvrocks:
  addr: localhost:6666
  auth:
    mode: none
    password: ""

codeq:
  base_url: http://localhost:8080
  producer_token: ""
  worker_token: ""
  brokers: []
  topics:
    invoke: cs.invoke
    results: cs.results
    dlq_invoke: cs.dlq.invoke
    dlq_results: cs.dlq.results

tikti:
  introspection_url: http://localhost:8099/introspect
  cache_ttl_seconds: 60
  api_key: ""

cs_control:
  http:
    addr: :8080
  limits:
    max_bundle_bytes: 16777216
    draft_ttl_seconds: 86400
    activation_ttl_seconds: 604800

cs_http_gateway:
  http:
    addr: :8081
  limits:
    max_body_bytes: 6291456
    max_header_bytes: 65536
    max_query_bytes: 16384
  rate_limits:
    tenant_rps: 200
    function_rps: 20

cs_invoker_pool:
  http:
    addr: :8082
  workers:
    threads: 32
    max_inflight: 2048
  cache:
    bundles_max: 1000
    bytes_max: 536870912
  limits:
    max_result_bytes: 262144
    max_error_bytes: 65536
    max_log_bytes: 1048576

cs_scheduler:
  tick_ms: 1000
  max_catchup_ticks: 60
  leader_election:
    enabled: true
    lease_name: cs-scheduler

cs_cadence_poller:
  cadence:
    addr: localhost:7933
  refresh_seconds: 10
  heartbeat:
    max_per_second: 2
  limits:
    max_inflight_tasks_default: 256
