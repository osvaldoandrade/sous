{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "cs.function.script.v1",
  "type": "object",
  "required": ["schema", "runtime", "entry", "handler", "limits", "capabilities"],
  "properties": {
    "schema": { "const": "cs.function.script.v1" },
    "runtime": { "const": "cs-js" },
    "entry": { "type": "string", "pattern": "^[a-zA-Z0-9._/-]+$" },
    "handler": { "type": "string", "const": "default" },
    "limits": {
      "type": "object",
      "required": ["timeoutMs", "memoryMb", "maxConcurrency"],
      "properties": {
        "timeoutMs": { "type": "integer", "minimum": 1, "maximum": 900000 },
        "memoryMb": { "type": "integer", "minimum": 16, "maximum": 4096 },
        "maxConcurrency": { "type": "integer", "minimum": 1, "maximum": 100 }
      },
      "additionalProperties": false
    },
    "capabilities": {
      "type": "object",
      "required": ["kv", "codeq", "http"],
      "properties": {
        "kv": {
          "type": "object",
          "required": ["prefixes", "ops"],
          "properties": {
            "prefixes": {
              "type": "array",
              "items": { "type": "string", "minLength": 1, "maxLength": 256 },
              "maxItems": 64
            },
            "ops": {
              "type": "array",
              "items": { "enum": ["get", "set", "del"] },
              "maxItems": 3
            }
          },
          "additionalProperties": false
        },
        "codeq": {
          "type": "object",
          "required": ["publishTopics"],
          "properties": {
            "publishTopics": {
              "type": "array",
              "items": { "type": "string", "minLength": 1, "maxLength": 256 },
              "maxItems": 64
            }
          },
          "additionalProperties": false
        },
        "http": {
          "type": "object",
          "required": ["allowHosts", "timeoutMs"],
          "properties": {
            "allowHosts": {
              "type": "array",
              "items": { "type": "string", "minLength": 1, "maxLength": 253 },
              "maxItems": 128
            },
            "timeoutMs": { "type": "integer", "minimum": 1, "maximum": 30000 }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
